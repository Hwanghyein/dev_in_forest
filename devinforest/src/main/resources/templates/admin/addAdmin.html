<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>관리자 추가</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<style>
			.none{
				border: 0px;
			}
			.adminEmailArea{
				border: 1px solid black;
				padding : 1px;
			}
			.width1{
				width: 80px;
			}
			.width2{
				width: 110px;
			}
		</style>
	</head>
	<body>
		<div>
			<h1>관리자 추가</h1>		
		</div>
		<form id="form" method="post" th:action="@{/addAdmin}">
			<input id="adminEmail" type="hidden" name="adminEmail" value="">
			<input id="adminName" type="hidden" name="adminName" value="">
			<div>
				<div>
					<span th:text="이메일"></span>
				</div>
				<div>
					<span class="adminEmailArea">
						<input id="adminEmail2" class="none width1" type="text" name="adminEmail2" placeholder="아이디">
						<span>@devinforest.com</span>
					</span>
					<button id="emailCheckBtn" type="button">중복확인</button>
					<span id="emailMsg"></span>
				</div>
			</div>
			<div>
				<div>
					<span th:text="닉네임"></span>
				</div>
				<div>
					<input id="adminName2" type="text" name="adminName2" placeholder="닉네임을 입력해주세요.">
					<button id="nameCheckBtn" type="button">중복확인</button>
					<span id="nameMsg"></span>
				</div>
			</div>
			<div>
				<div>
					<span th:text="비밀번호"></span>
				</div>
				<div>
					<input id="adminPw" type="password" name="adminPw" placeholder="비밀번호를 입력해주세요.">			
				</div>
			</div>
			<div>
				<button type="button" id="signUpBtn">가입</button>
			</div>
		</form>
	</body>
	<script>
	// 회원가입 유효성 검사
	$('#signUpBtn').click(function(){		
		let pw = $('#adminPw').val();
		let pwNum = pw.search(/[0-9]/);
		let pwEng = pw.search(/[a-z]/);
		let pwSpe = pw.search(/[`~!@@#$%^&*|₩₩₩'₩";:₩/?]/);
		
		// 아이디 중복체크 검사
		if($('#adminEmail').val() == ''){
			 alert("아이디를 중복체크 해주세요.");
			 return;
		}
		
		// 닉네임 중복체크 검사
		if($('#adminName').val() == ''){
			 alert("닉네임을 중복체크 해주세요.");
			 return;
		}
		
		// 비밀번호 유효성 검사
		if(pw.length < 8 || pw.length > 20){
			 alert("비밀번호는 8자리 ~ 20자리 이내로 입력해주세요.");
			 return;
		}
		if(pw.search(/\s/) != -1){
			alert("비밀번호는 공백 없이 입력해주세요.");
			return;
		}
		if(pwNum < 0 || pwEng < 0 || pwSpe < 0 ){
		 	alert("영문, 숫자, 특수문자를 혼합하여 입력해주세요.");
			return;
		}
		console.log('유효성 검사 통과');
		$('#form').submit();
		
	});
	// 아이디 중복체크
	$('#emailCheckBtn').click(function(){
		$('#adminEmail').val('');
		let email = $('#adminEmail2').val();
		let emailNum = email.search(/[0-9]/);
		console.log(emailNum+" <- emailNum");
		let emailEng = email.search(/[a-z]/);
		console.log(emailEng+" <- emailEng");
		let emailBigEng = email.search(/[A-Z]/);
		console.log(emailBigEng+" <- emailBigEng");
		let emailKor = email.search(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/);
		console.log(emailKor+" <- emailKor");
		let emailSpe = email.search(/[`~!@@#$%^&*|₩₩₩'₩";:₩/?]/);
		console.log(emailSpe+" <- emailSpe");
		console.log("----------------------");
		
		if(email.length < 5 || email.length > 20){
			 alert("아이디는 5자리 ~ 20자리 이내로 입력해주세요.");
			 return;
		}
		if(email.search(/\s/) != -1){
	 		alert("아이디는 공백 없이 입력해주세요.");
		 	return;
		}
		if(emailSpe != -1){
			alert("아이디는 특수문자 없이 입력해주세요.");
			return;
		}
		if(emailKor != -1 || emailBigEng != -1 || emailNum == 0){
			alert("아이디는 영문 소문자+숫자 또는, 영문 소문자로 입력해주세요.");
			return;
		}
		
		let adminEmail2 = $('#adminEmail2').val();
		$.ajax({
            url:'/checkAdminEmail'
            ,type:'POST'
            ,data:{'adminEmail2':adminEmail2}
            ,success : function(data) {
        		console.log(data);
        		$('#emailMsg').text(data);
        		if(data == "사용가능한 이메일입니다.") {
        			$('#adminEmail').val(email);
        		}
            }
		});
	});
	
	$('#nameCheckBtn').click(function(){
		$('#adminName').val('');
		let name = $('#adminName2').val();
		let nameNum = name.search(/[0-9]/);
		let nameEng = name.search(/[a-z]/);
		let nameSpe = name.search(/[`~!@@#$%^&*|₩₩₩'₩";:₩/?]/);
		
		if(name.length < 2 || name.length > 10){
			 alert("닉네임은 2자리 ~ 10자리 이내로 입력해주세요.");
			 return;
		}
		if(name.search(/\s/) != -1){
	 		alert("닉네임은 공백 없이 입력해주세요.");
		 	return;
		}
		if(nameSpe != -1){
	 		alert("닉네임은 특수문자를 포함할 수 없습니다.");
		 	return;
		}
		
		let adminName2 = $('#adminName2').val();
		$.ajax({
            url:'/checkAdminName'
            ,type:'POST'
            ,data:{'adminName2':adminName2}
            ,success : function(data) {
        		console.log(data);
        		$('#nameMsg').text(data);
        		if(data == "사용가능한 닉네임입니다.") {
        			$('#adminName').val(name);
        		}
            }
		});
	});
	</script>
</html>